dist: trusty
sudo: required
language: elixir
elixir:
- 1.4.0
cache:
  directories:
  - _build
  - deps
  - travis_phantomjs
before_install:
- openssl aes-256-cbc -K $encrypted_f30f7215314e_key -iv $encrypted_f30f7215314e_iv
  -in deploy_key.enc -out ./id_rsa -d
- phantomjs --version
- export PATH=$PWD/travis_phantomjs/phantomjs-2.1.1-linux-x86_64/bin:$PATH
- hash -d phantomjs || true
- phantomjs --version
- if [ $(phantomjs --version) != '2.1.1' ]; then rm -rf $PWD/travis_phantomjs; mkdir
  -p $PWD/travis_phantomjs; fi
- if [ $(phantomjs --version) != '2.1.1' ]; then wget https://assets.membergetmember.co/software/phantomjs-2.1.1-linux-x86_64.tar.bz2
  -O $PWD/travis_phantomjs/phantomjs-2.1.1-linux-x86_64.tar.bz2; fi
- if [ $(phantomjs --version) != '2.1.1' ]; then tar -xvf $PWD/travis_phantomjs/phantomjs-2.1.1-linux-x86_64.tar.bz2
  -C $PWD/travis_phantomjs; fi
- phantomjs --version
after_success:
- chmod 600 ~/.ssh/id_rsa
- ls -lath ~/.ssh
- ssh -o "StrictHostKeyChecking no" -q root@51.140.86.5 exit && echo $?
- mix edeliver build upgrade --auto-version=git-revision --from=$(curl http://51.140.86.5/_version) --to=$(git rev-parse HEAD) --verbose
- mix edeliver deploy upgrade to production --version=$(.deliver/version.sh) --verbose
